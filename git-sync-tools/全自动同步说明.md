# 🚀 Git仓库全自动同步方案

## 📋 方案概述

本方案提供完全自动化的Git仓库同步功能，无需人工干预，自动检测更改、提交、拉取和推送。

## ✨ 核心特性

- 🔄 **完全自动化** - 无需人工干预
- ⏰ **定时同步** - 可配置同步间隔（默认5分钟）
- 📝 **自动提交** - 检测本地更改并自动提交
- 🔄 **双向同步** - 自动拉取远程更新并推送本地更改
- 🛡️ **冲突处理** - 智能处理合并冲突
- 📊 **详细日志** - 记录所有同步操作
- 🔧 **灵活配置** - 支持多种配置选项

## 🛠️ 文件说明

### 核心文件
- `auto-sync.ps1` - 主同步脚本（PowerShell）
- `auto-sync.bat` - 批处理版本同步脚本
- `setup-auto-sync.ps1` - 自动设置任务计划
- `一键设置全自动同步.bat` - 一键设置工具
- `auto-sync-config.json` - 配置文件

### 辅助文件
- `sync.log` - 同步日志文件（自动生成）
- `backup/` - 备份目录（自动创建）

## 🚀 快速开始

### 方法一：一键设置（推荐）

1. **右键点击** `一键设置全自动同步.bat`
2. **选择** "以管理员身份运行"
3. **确认** 设置信息
4. **等待** 设置完成

### 方法二：手动设置

1. **以管理员身份打开PowerShell**
2. **运行设置脚本**：
   ```powershell
   powershell -ExecutionPolicy Bypass -File "setup-auto-sync.ps1" -Force
   ```

## ⚙️ 配置选项

### 基本配置
```json
{
  "sync": {
    "enabled": true,           // 启用同步
    "interval": 5,             // 同步间隔（分钟）
    "taskName": "GitAutoSync", // 任务名称
    "repoPath": "E:\\AI炼金师-产品优化专家 (2)", // 仓库路径
    "remote": "origin",        // 远程仓库别名
    "branch": "main",          // 分支名称
    "silent": true,            // 静默模式
    "autoCommit": true,        // 自动提交
    "autoPush": true           // 自动推送
  }
}
```

### 高级配置
```json
{
  "conflictStrategy": "rebase", // 冲突处理策略
  "retryAttempts": 3,          // 重试次数
  "retryDelay": 30,            // 重试延迟（秒）
  "backup": {
    "enabled": true,           // 启用备份
    "backupPath": "backup",    // 备份路径
    "maxBackups": 10,          // 最大备份数
    "backupBeforeSync": true   // 同步前备份
  }
}
```

## 🔧 管理命令

### 任务管理
```powershell
# 查看任务状态
Get-ScheduledTask -TaskName "GitAutoSync"

# 启动任务
Start-ScheduledTask -TaskName "GitAutoSync"

# 停止任务
Stop-ScheduledTask -TaskName "GitAutoSync"

# 删除任务
Unregister-ScheduledTask -TaskName "GitAutoSync" -Confirm:$false
```

### 手动同步
```powershell
# 手动执行同步
.\auto-sync.ps1

# 静默同步
.\auto-sync.ps1 -Silent

# 指定参数同步
.\auto-sync.ps1 -RepoPath "C:\path\to\repo" -SyncInterval 10
```

## 📊 日志监控

### 查看同步日志
```powershell
# 查看最新日志
Get-Content "sync.log" -Tail 20

# 实时监控日志
Get-Content "sync.log" -Wait

# 搜索错误日志
Get-Content "sync.log" | Select-String "ERROR"
```

### 日志格式
```
[2024-12-19 14:30:15] [INFO] 开始Git仓库自动同步
[2024-12-19 14:30:15] [INFO] 仓库路径: E:\AI炼金师-产品优化专家 (2)
[2024-12-19 14:30:16] [INFO] 发现本地更改，正在自动提交...
[2024-12-19 14:30:17] [INFO] 本地更改已自动提交
[2024-12-19 14:30:18] [INFO] 拉取远程更新...
[2024-12-19 14:30:20] [INFO] 远程更新拉取成功
[2024-12-19 14:30:21] [INFO] 推送本地更改...
[2024-12-19 14:30:23] [INFO] 本地更改推送成功
[2024-12-19 14:30:23] [INFO] Git仓库同步完成
```

## 🛡️ 安全特性

### 冲突处理
- **自动检测** - 检测合并冲突
- **智能解决** - 尝试rebase方式解决
- **安全回退** - 冲突时自动回退
- **详细报告** - 记录冲突处理过程

### 备份机制
- **同步前备份** - 自动创建备份
- **版本管理** - 保留多个备份版本
- **自动清理** - 清理过期备份
- **恢复功能** - 支持从备份恢复

### 错误处理
- **重试机制** - 失败时自动重试
- **超时控制** - 防止长时间阻塞
- **错误日志** - 详细记录错误信息
- **优雅降级** - 部分失败时继续运行

## 🔍 故障排除

### 常见问题

**Q: 任务计划创建失败？**
A: 确保以管理员身份运行，检查PowerShell执行策略

**Q: 同步失败，显示权限错误？**
A: 配置Git身份验证（SSH密钥或Personal Access Token）

**Q: 冲突无法自动解决？**
A: 查看日志文件，手动解决冲突后重新同步

**Q: 同步频率过高？**
A: 修改配置文件中的interval参数

### 调试模式
```powershell
# 启用详细日志
.\auto-sync.ps1 -Silent:$false

# 查看任务执行历史
Get-ScheduledTask -TaskName "GitAutoSync" | Get-ScheduledTaskInfo
```

## 📈 性能优化

### 同步优化
- **增量同步** - 只同步变更文件
- **并行处理** - 支持多仓库并行同步
- **缓存机制** - 缓存远程状态信息
- **网络优化** - 支持代理和镜像

### 资源管理
- **内存控制** - 限制内存使用
- **CPU限制** - 避免占用过多CPU
- **磁盘优化** - 定期清理临时文件
- **网络控制** - 限制网络带宽使用

## 🎯 使用场景

### 个人开发
- 多设备代码同步
- 自动备份重要代码
- 版本控制自动化

### 团队协作
- 实时同步团队代码
- 自动合并分支
- 冲突预警和处理

### 持续集成
- 自动部署触发
- 代码质量检查
- 测试自动化

## 📞 技术支持

### 获取帮助
- 查看日志文件：`sync.log`
- 检查任务状态：`Get-ScheduledTask -TaskName "GitAutoSync"`
- 手动测试：`.\auto-sync.ps1`

### 更新和维护
- 定期检查日志文件
- 监控磁盘空间使用
- 更新Git和PowerShell版本

---

**🎉 现在您的Git仓库将完全自动化同步，无需任何人工干预！** 